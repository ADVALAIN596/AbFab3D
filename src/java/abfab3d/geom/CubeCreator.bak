/*****************************************************************************
 *                        Alan Hudson Copyright (c) 2011
 *                               Java Source
 *
 * This source is private and not licensed for any use.
 *
 * This software comes with the standard NO WARRANTY disclaimer for any
 * purpose. Use it at your own risk. If there's a problem you get to fix it.
 *
 ****************************************************************************/

package abfab3d.geom;

// External Imports
import java.util.*;
import java.io.*;
import org.web3d.vrml.sav.ContentHandler;

// Internal Imports
import abfab3d.grid.Grid;

/**
 * Creates a cube following the patterns specified.
 *
 * Face numbers start with front face.  The order
 * is front,top,back,bottom,left,right
 *
 * @author Alan Hudson
 */
public class CubeCreator extends GeometryCreator {
    public enum Style {
        TOP_ROW,
        BOTTOM_ROW,
        LEFT_ROW,
        RIGHT_ROW,
        EMPTY
    }

    /** List of Styles by face. */
    private Style[][] styles;

    protected double width;
    protected double height;
    protected double depth;

    // The center position
    protected double x;
    protected double y;
    protected double z;

    protected byte materialID;

    /**
     * Constructor.
     *
     * @param styles The styles for each face.  Front,Back,Left,Right,Top,Bottom
     */
    public CubeCreator(Style[][] styles,
        double w, double h, double d,
        double x, double y, double z,
        byte material) {
        this.styles = new Style[6][styles.length];

        for(int i=0; i < 6; i++) {
            if (styles[i] == null)
                continue;

            for(int j=0; j < styles[i].length; j++) {
                this.styles[i][j] = styles[i][j];
            }
        }

        width = w;
        height = h;
        depth = d;
        this.x = x;
        this.y = y;
        this.z = z;
        this.materialID = material;
    }

    /**
     * Generate the geometry and issue commands to the provided handler.
     *
     * @param handler The stream to issue commands
     */
    public void generate(Grid grid) {
        Style[] side_styles = styles[0];

        double x_pos,y_pos,z_pos;
        double vsize = grid.getVoxelSize();
        double hvsize = vsize / 2.0;
        double sheight = grid.getSliceHeight();
        double hsheight = grid.getSliceHeight() / 2.0;

//System.out.println("hvsize: " + hvsize + " hsheight: " + hsheight);
        int len;
        // Front.  XY plane

        if (side_styles != null) {
            for(int i=0; i < side_styles.length; i++) {
                double ulx,uly,ulz;     // upper left corner
                double llx,lly,llz;     // lower left corner
                double lrx,lry,lrz;     // lower right corner
                double urx,ury,urz;     // upper right corner

                ulx = x - width / 2.0;
                uly = y + height / 2.0;
                ulz = z + depth / 2.0;

                urx = x + width / 2.0;
                ury = y + height / 2.0;
                urz = z + depth / 2.0;

                llx = x - width / 2.0;
                lly = y - height / 2.0;
                llz = z + depth / 2.0;

                lrx = x + width / 2.0;
                lry = y - height / 2.0;
                lrz = z + depth / 2.0;

System.out.println("ul: " + ulx + " " + uly + " " + ulz);
System.out.println("ur: " + urx + " " + ury + " " + urz);
System.out.println("ll: " + llx + " " + lly + " " + llz);
System.out.println("lr: " + lrx + " " + lry + " " + lrz);

                if (side_styles[i] == Style.TOP_ROW) {
                    y_pos = uly;
                    z_pos = ulz;


                    len = (int) Math.ceil(width / vsize);

                    x_pos = ulx + (len-1) * vsize;
                    if (x_pos <= urx) {
                        len++;
                    }

System.out.println("Top Row: " + len);

                    for(int x_idx = 0; x_idx < len; x_idx++) {
                        x_pos = ulx + x_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.BOTTOM_ROW) {
System.out.println("Bottom Row");
                    y_pos = lly;
                    z_pos = ulz;

                    len = (int) Math.ceil(width / vsize);

                    x_pos = llx + (len-1) * vsize;
                    if (x_pos <= lrx) {
                        len++;
                    }

                    for(int x_idx = 0; x_idx < len; x_idx++) {
                        x_pos = llx + x_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.LEFT_ROW) {
System.out.println("Left Row");
                    x_pos = llx;
                    z_pos = llz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lly + (len-1) * vsize;
                    if (y_pos <= uly) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lly + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.RIGHT_ROW) {
System.out.println("Right Row");
                    x_pos = lrx;
                    z_pos = lrz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lry + (len-1) * vsize;
                    if (y_pos <= ury) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lry + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                }
            }
        }

        side_styles = styles[1];

        // Back.  XY plane

        if (side_styles != null) {
            for(int i=0; i < side_styles.length; i++) {
                double ulx,uly,ulz;     // upper left corner
                double llx,lly,llz;     // lower left corner
                double lrx,lry,lrz;     // lower right corner
                double urx,ury,urz;     // upper right corner

                ulx = x - width / 2.0;
                uly = y + height / 2.0;
                ulz = z - depth / 2.0;

                urx = x + width / 2.0;
                ury = y + height / 2.0;
                urz = z - depth / 2.0;

                llx = x - width / 2.0;
                lly = y - height / 2.0;
                llz = z - depth / 2.0;

                lrx = x + width / 2.0;
                lry = y - height / 2.0;
                lrz = z - depth / 2.0;
/*
System.out.println("ul: " + ulx + " " + uly + " " + ulz);
System.out.println("ur: " + urx + " " + ury + " " + urz);
System.out.println("ll: " + llx + " " + lly + " " + llz);
System.out.println("lr: " + lrx + " " + lry + " " + lrz);
*/
                if (side_styles[i] == Style.TOP_ROW) {
                    y_pos = uly;
                    z_pos = ulz;


                    len = (int) Math.ceil(width / vsize);

                    x_pos = ulx + (len-1) * vsize;
                    if (x_pos <= urx) {
                        len++;
                    }

//System.out.println("Top Row: " + len);

                    for(int x_idx = 0; x_idx < len; x_idx++) {
                        x_pos = ulx + x_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.BOTTOM_ROW) {
//System.out.println("Bottom Row");
                    y_pos = lly;
                    z_pos = ulz;

                    len = (int) Math.ceil(width / vsize);

                    x_pos = llx + (len-1) * vsize;
                    if (x_pos <= lrx) {
                        len++;
                    }

                    for(int x_idx = 0; x_idx < len; x_idx++) {
                        x_pos = llx + x_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.LEFT_ROW) {
//System.out.println("Left Row");
                    x_pos = llx;
                    z_pos = llz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lly + (len-1) * vsize;
                    if (y_pos <= uly) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lly + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.RIGHT_ROW) {
//System.out.println("Right Row");
                    x_pos = lrx;
                    z_pos = lrz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lry + (len-1) * vsize;
                    if (y_pos <= ury) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lry + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                }
            }
        }

        side_styles = styles[1];

        // Left.  XZ plane

        if (side_styles != null) {
            for(int i=0; i < side_styles.length; i++) {
                double ulx,uly,ulz;     // upper left corner
                double llx,lly,llz;     // lower left corner
                double lrx,lry,lrz;     // lower right corner
                double urx,ury,urz;     // upper right corner

                ulx = x - width / 2.0;
                uly = y + height / 2.0;
                ulz = z - depth / 2.0;

                urx = x - width / 2.0;
                ury = y + height / 2.0;
                urz = z + depth / 2.0;

                llx = x - width / 2.0;
                lly = y - height / 2.0;
                llz = z - depth / 2.0;

                lrx = x - width / 2.0;
                lry = y - height / 2.0;
                lrz = z + depth / 2.0;
/*
System.out.println("ul: " + ulx + " " + uly + " " + ulz);
System.out.println("ur: " + urx + " " + ury + " " + urz);
System.out.println("ll: " + llx + " " + lly + " " + llz);
System.out.println("lr: " + lrx + " " + lry + " " + lrz);
*/
                if (side_styles[i] == Style.TOP_ROW) {
                    x_pos = ulx;
                    y_pos = uly;

                    len = (int) Math.ceil(depth / vsize);

                    z_pos = ulz + (len-1) * vsize;
                    if (z_pos <= urz) {
                        len++;
                    }

//System.out.println("Top Row: " + len);

                    for(int z_idx = 0; z_idx < len; z_idx++) {
                        z_pos = ulz + z_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.BOTTOM_ROW) {
                    x_pos = llx;
                    y_pos = lly;

                    len = (int) Math.ceil(depth / vsize);

                    z_pos = llz + (len-1) * vsize;
                    if (z_pos <= lrz) {
                        len++;
                    }

//System.out.println("Bottom Row: " + len);

                    for(int z_idx = 0; z_idx < len; z_idx++) {
                        z_pos = llz + z_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.LEFT_ROW) {
//System.out.println("Left Row");
                    x_pos = llx;
                    z_pos = llz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lly + (len-1) * vsize;
                    if (y_pos <= uly) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lly + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.RIGHT_ROW) {
//System.out.println("Right Row");
                    x_pos = lrx;
                    z_pos = lrz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lry + (len-1) * vsize;
                    if (y_pos <= ury) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lry + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                }
            }
        }

        side_styles = styles[2];

        // Right.  XZ plane

        if (side_styles != null) {
            for(int i=0; i < side_styles.length; i++) {
                double ulx,uly,ulz;     // upper left corner
                double llx,lly,llz;     // lower left corner
                double lrx,lry,lrz;     // lower right corner
                double urx,ury,urz;     // upper right corner

                ulx = x + width / 2.0;
                uly = y + height / 2.0;
                ulz = z - depth / 2.0;

                urx = x + width / 2.0;
                ury = y + height / 2.0;
                urz = z + depth / 2.0;

                llx = x + width / 2.0;
                lly = y - height / 2.0;
                llz = z - depth / 2.0;

                lrx = x + width / 2.0;
                lry = y - height / 2.0;
                lrz = z + depth / 2.0;

/*
System.out.println("ul: " + ulx + " " + uly + " " + ulz);
System.out.println("ur: " + urx + " " + ury + " " + urz);
System.out.println("ll: " + llx + " " + lly + " " + llz);
System.out.println("lr: " + lrx + " " + lry + " " + lrz);
*/
                if (side_styles[i] == Style.TOP_ROW) {
                    x_pos = ulx;
                    y_pos = uly;

                    len = (int) Math.ceil(depth / vsize);

                    z_pos = ulz + (len-1) * vsize;
                    if (z_pos <= urz) {
                        len++;
                    }

//System.out.println("Top Row: " + len);

                    for(int z_idx = 0; z_idx < len; z_idx++) {
                        z_pos = ulz + z_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.BOTTOM_ROW) {
                    x_pos = llx;
                    y_pos = lly;

                    len = (int) Math.ceil(depth / vsize);

                    z_pos = llz + (len-1) * vsize;
                    if (z_pos <= lrz) {
                        len++;
                    }

//System.out.println("Bottom Row: " + len);

                    for(int z_idx = 0; z_idx < len; z_idx++) {
                        z_pos = llz + z_idx * vsize;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.LEFT_ROW) {
//System.out.println("Left Row");
                    x_pos = llx;
                    z_pos = llz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lly + (len-1) * vsize;
                    if (y_pos <= uly) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lly + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                } else  if (side_styles[i] == Style.RIGHT_ROW) {
//System.out.println("Right Row");
                    x_pos = lrx;
                    z_pos = lrz;

                    len = (int) Math.ceil(height / sheight);

                    y_pos = lry + (len-1) * vsize;
                    if (y_pos <= ury) {
                        len++;
                    }

                    for(int y_idx = 0; y_idx < len; y_idx++) {
                        y_pos = lry + y_idx * sheight;
                        grid.setData(x_pos, y_pos, z_pos, materialID);
                    }
                }
            }
        }

//        System.out.println("Final Grid:");
//        System.out.println(grid.toStringAll());
    }
}
